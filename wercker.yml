build:
  box:
    id: youyo/hugo:0.18
    cmd: /bin/sh
  steps:
    - script:
      name: Build static pages.
      code: |-
        hugo
        sed -i "s|//blog.youyo.info|https://blog.youyo.info|g" public/sitemap.xml
  after-steps:
    - slack-notifier:
      url: 'https://hooks.slack.com/services/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'

deploy:
  box:
    id: youyo/awscli:1.10.60
    cmd: /bin/sh
  steps:
    - script:
      name: Deploy
      code: |-
        aws s3 sync --delete public/ s3://blog.youyo.info/
  after-steps:
    - slack-notifier:
      url: 'https://hooks.slack.com/services/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'

cache:
  box:
    id: youyo/curl:latest
    cmd: /bin/sh
  steps:
    - script:
      name: Clear Cache
      code: |-
        curl -X POST -H "Fastly-Key: ${FASTLY_APIKEY}" https://api.fastly.com/service/${FASTLY_SERVICE_ID}/purge_all
  after-steps:
    - slack-notifier:
      url: 'https://hooks.slack.com/services/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'
